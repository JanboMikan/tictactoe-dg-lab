# DG-LAB 郊狼控制 - 最小实现

这是一个 DG-LAB 郊狼 V3 的最小控制实现，用于测试和学习。

## 安装依赖

```bash
cd test
npm install
```

## 运行

```bash
npm start
```

## 使用步骤

1. **启动服务器**
   运行 `npm start` 后，会看到类似以下输出：
   ```
   ============================================================
   DG-LAB 郊狼控制服务启动
   ============================================================

   连接信息：
   WebSocket URL: ws://localhost:9999
   Client ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

   请使用 DG-LAB APP 扫描包含以下内容的二维码：
   https://www.dungeon-lab.com/app-download.php#DGLAB-SOCKET#ws://localhost:9999/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

   等待 APP 连接...
   ```

2. **生成二维码**
   使用任意二维码生成工具（如 https://www.qrcode-monkey.com/ 或手机应用），
   将输出的完整 URL 生成为二维码。

3. **APP 扫码连接**
   - 打开 DG-LAB APP
   - 确保郊狼主机已通过蓝牙连接到 APP
   - 扫描生成的二维码
   - 等待绑定成功提示

4. **控制设备**
   绑定成功后，会出现交互式命令行，可以输入以下命令：

   | 命令 | 说明 | 示例 |
   |------|------|------|
   | `<数字>` | 设置 A 通道强度 (0-200) | `50` |
   | `a<数字>` | 设置 A 通道强度 | `a75` |
   | `b<数字>` | 设置 B 通道强度 | `b100` |
   | `wave` | 发送基础波形到 A 通道 | `wave` |
   | `wave a` 或 `wave b` | 发送波形到指定通道 | `wave b` |
   | `clear` 或 `clear a` | 清空 A 通道队列 | `clear` |
   | `clear b` | 清空 B 通道队列 | `clear b` |
   | `quit` | 退出程序 | `quit` |

## 基础波形说明

内置的基础波形包含 6 种模式：
- 渐强-停止模式
- 更强-停止模式
- 持续中等强度
- 持续弱强度
- 持续强脉冲
- 交替模式

每个模式持续 100ms，总时长约 600ms，会循环播放。

## 注意事项

1. **安全第一**：强度从低开始测试，不要一开始就设置过高的值
2. **网络连接**：确保手机和运行服务器的设备在同一局域网
3. **端口占用**：默认使用 9999 端口，如需修改请编辑 `server.js` 中的 `PORT` 常量
4. **外网访问**：如需外网访问，需要配置端口转发和使用公网 IP/域名

## 开发说明

这是一个最小化实现，主要用于：
- 学习 DG-LAB Socket 协议
- 测试设备连接和控制
- 作为更复杂应用的起点

如需添加更多功能（如游戏集成、复杂波形、Web 界面等），可以在此基础上扩展。

## 协议参考

完整的协议文档请查看 `../memory-bank/dg-lab/dg-lab.md`
